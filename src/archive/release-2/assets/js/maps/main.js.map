{"version":3,"sources":["includes/coop-toolkit.js","includes/feedback.js","includes/FeedbackWrongInfo.js","main.js"],"names":["window","Coop","Modules","Events","$","init","x","ModuleInitDone","trigger","feedbackForm","toggles","toggleContent","formPosition","length","this","addClass","removeClass","attr","tabindex","aria-hidden","aria-live","bindEvents","self","change","offset","top","slideDown","animate","scrollTop","selector","FeedbackWrongInfo","$el","prototype","defaults","email","DOORBELL_EMAIL","doorbellId","DOORBELL_ID","doorbellKey","DOORBELL_KEY","$link","pk","data","$feedbackPanel","off","on","e","preventDefault","setupForm","openPanel","closePanel","renderedHtml","nunjucks","render","id","insertAfter","$closeButton","$submitButton","$form","bindPanelEvents","validateForm","sendFeedback","fireRefreshEventOnWindow","evt","document","createEvent","initEvent","dispatchEvent","find","focus","getMetadata","store_name","text","store_address","store_latlng","search_query","val","message","hasClass","ajax","url","properties","type","success","showSuccess","error","xhr","showError","complete","removeAttr","formIsValid","remove","replace","field","$field","$error","after","prepend","replaceWith","each","showElement","element","show","prop","hideElement","hide","toggleInputLabelClass","input","$input","parents","toggleClass","is","fixedsticky","not","$target","click","parent","siblings"],"mappings":"CACA,WACAA,OAAAC,KAAAD,OAAAC,OAEAC,WAEAC,OAAAC,MAEAC,KAAA,WAEA,IAAA,GAAAC,KAAAL,MAAAC,QACAD,KAAAC,QAAAI,GAAAC,kBAAA,GAAA,kBAAAN,MAAAC,QAAAI,GAAAD,OACAJ,KAAAC,QAAAI,GAAAD,OACAJ,KAAAC,QAAAI,GAAAC,gBAAA,EAIAN,MAAAE,OAAAK,QAAA,eCjBA,WAEA,YAEAR,QAAAC,KAAAD,OAAAC,OAAAC,YAEAD,KAAAC,QAAAO,cACAC,QAAA,KACAC,cAAA,KACAC,aAAA,KACAP,KAAA,WACAD,EAAA,wBAAAS,SAGAC,KAAAJ,QAAAN,EAAA,qCACAU,KAAAH,cAAAP,EAAA,uCACAU,KAAAH,cAAAI,SAAA,QAAAC,YAAA,QAAAC,MAAAC,SAAA,KAAAC,cAAA,OAAAC,YAAA,WACAN,KAAAO,eAEAA,WAAA,WACA,GAAAC,GAAAR,IAEAA,MAAAJ,QAAAa,OAAA,WACAD,EAAAV,aAAAR,EAAA,iBAAAoB,SAAAC,IACAH,EAAAX,cAAAe,UAAA,KAAAX,SAAA,QAAAE,KAAA,cAAA,SACAb,EAAA,cAAAuB,SAAAC,UAAAN,EAAAV,cAAA,YCzBA,WACA,YAEAZ,QAAAC,KAAAD,OAAAC,OAAAC,WAEA,IAAA2B,GAAA,6BAEAC,EAAA,SAAAC,GAEA,MADAjB,MAAAT,KAAA0B,GACAjB,KAGAgB,GAAAE,WACAC,UACAC,MAAAlC,OAAAmC,eACAC,WAAApC,OAAAqC,YACAC,YAAAtC,OAAAuC,cAEAlC,KAAA,SAAA0B,GACAjB,KAAA0B,MAAAT,EACAjB,KAAA2B,GAAA3B,KAAA0B,MAAAE,KAAA,uBACA5B,KAAA6B,eAAAvC,EAAA,mBAAAU,KAAA2B,IAEA3B,KAAAO,cAEAA,WAAA,WACA,GAAAC,GAAAR,IAEAA,MAAA0B,MACAI,IAAA,mBACAC,GAAA,kBAAA,SAAAC,GACAA,EAAAC,iBAEAzB,EAAA0B,YAEA,UAAA1B,EAAAkB,MAAAvB,KAAA,iBACAK,EAAA2B,YAGA3B,EAAA4B,gBAIAF,UAAA,WACA,GACAG,EAEA/C,GAAA,uBAAAU,KAAA2B,GAAA,KAAA5B,SAIAsC,EAAAC,SAAAC,OAAA,iBAAAC,GAAAxC,KAAA2B,KAEA3B,KAAA6B,eAAAvC,EAAA+C,GAAAI,YAAAzC,KAAA0B,OAEA1B,KAAA0B,MAAAvB,KAAA,gBAAA,kBAAAH,KAAA2B,IAAAxB,KAAA,gBAAA,SACAH,KAAA6B,eAAA1B,KAAA,cAAA,QAEAH,KAAA0C,aAAApD,EAAA,aAAAU,KAAA6B,gBACA7B,KAAA2C,cAAArD,EAAA,SAAAU,KAAA6B,gBACA7B,KAAA4C,MAAAtD,EAAA,OAAAU,KAAA6B,gBAEA7B,KAAA6C,oBAEAA,gBAAA,WACA,GAAArC,GAAAR,IAEAA,MAAA0C,aAAAX,GAAA,QAAA,SAAAC,GACAA,EAAAC,iBACAzB,EAAA4B,eAGApC,KAAA4C,MAAAb,GAAA,mBAAA,SAAAC,GACAA,EAAAC,iBACAzB,EAAAsC,gBACAtC,EAAAuC,kBAIAC,yBAAA,WACA,GAAAC,GAAAC,SAAAC,YAAA,aACAF,GAAAG,UAAA,UAAA,GAAA,GACAlE,OAAAmE,cAAAJ,IAEAd,UAAA,WACAnC,KAAA0B,MAAAvB,KAAA,gBAAA,QACAH,KAAA6B,eAAA1B,KAAA,cAAA,SAAAmD,KAAA,YAAAC,QACAvD,KAAAgD,4BAEAZ,WAAA,WACApC,KAAA0B,MAAAvB,KAAA,gBAAA,SACAH,KAAA6B,eAAA1B,KAAA,cAAA,QACAH,KAAAgD,4BAEAQ,YAAA,WACA,OACA7B,GAAA3B,KAAA2B,GACA8B,WAAAnE,EAAA,kBAAAU,KAAA2B,GAAA,iBAAA+B,OACAC,cAAArE,EAAA,UAAAU,KAAA2B,GAAA,mBAAA+B,OACAE,aAAAtE,EAAA,kBAAAU,KAAA2B,GAAA,KAAAC,KAAA,UACAiC,aAAAvE,EAAA,MAAAwE,QAGAf,aAAA,WACA,GAAAvC,GAAAR,KACA+D,EAAAzE,EAAA,kBAAAU,KAAA4C,OAAAkB,KAEA9D,MAAA2C,cAAAqB,SAAA,iBAIAhE,KAAA2C,cAAAxC,KAAA,YAAA,GAAAF,SAAA,eAEAX,EAAA2E,MACAC,IAAA,wCAAAlE,KAAAmB,SAAAG,WAAA,eAAAtB,KAAAmB,SAAAK,YACAI,MACAR,MAAApB,KAAAmB,SAAAC,MACA2C,QAAAA,EACAI,WAAAnE,KAAAwD,eAEAY,KAAA,OACAC,QAAA,WACA7D,EAAA8D,eAEAC,MAAA,SAAAC,EAAAD,GACA/D,EAAAiE,UAAA,KAAA,0EAEAC,SAAA,WACAlE,EAAAmC,cAAAgC,WAAA,YAAAzE,YAAA,oBAIA4C,aAAA,WACA,GAAA8B,IAAA,CAUA,OARA5E,MAAA4C,MAAAU,KAAA,gBAAAuB,SACA7E,KAAA4C,MAAAU,KAAA,YAAApD,YAAA,WAEA,KAAAF,KAAA4C,MAAAU,KAAA,YAAAQ,MAAAgB,QAAA,eAAA,MACAF,GAAA,EACA5E,KAAAyE,UAAA,WAAA,4DAGAG,GAEAH,UAAA,SAAAM,EAAAhB,GACA,GAAAiB,GAAA1F,EAAA,SAAAyF,EAAA,IAAA/E,KAAA4C,OACAqC,EAAA3F,EAAA,8BAAAoE,KAAAK,EAEAiB,GAAAjF,OACAiF,EAAA/E,SAAA,WAAAiF,MAAAD,GAGAjF,KAAA4C,MAAAuC,QAAAF,GAGAjF,KAAAgD,4BAEAsB,YAAA,WACA,GAAA9D,GAAAR,IAEAA,MAAA4C,MAAAwC,YAAA,2GACApF,KAAA0C,aAAAX,GAAA,QAAA,SAAAC,GACAA,EAAAC,iBACAzB,EAAAqB,eAAAgD,SACArE,EAAAkB,MACAiD,WAAA,iBACAA,WAAA,iBAEAnE,EAAAjB,KAAAiB,EAAAkB,WAKAvC,KAAAC,QAAA4B,mBACAzB,KAAA,WACA,MAAAD,GAAAyB,GAAAsE,KAAA,WACA/F,EAAAU,MAAA4B,KAAA,oBAAA,GAAAZ,GAAA1B,EAAAU,eC7KAV,EAAA,WA2CA,QAAAgG,GAAAC,GACAjG,EAAAiG,GAAAC,OAAAb,WAAA,UAAAxE,KAAA,eAAA,GACAb,EAAAiG,GAAAjC,KAAA,UAAAmC,KAAA,YAAA,GAGA,QAAAC,GAAAH,GACAjG,EAAAiG,GAAAI,OAAAxF,KAAA,SAAA,IAAAA,KAAA,eAAA,GACAb,EAAAiG,GAAAjC,KAAA,UAAAmC,KAAA,YAAA,GAiDA,QAAAG,GAAAC,GACA,GAAAC,GAAAxG,EAAAuG,EAEAC,GAAAC,QAAA,gBAAAC,YAAA,UAAAF,EAAAG,GAAA,aApGA3G,EAAA,gBAAA4G,cAuCA/G,KAAAI,OAaAD,EAAA4D,UAAAnB,GAAA,SAAA,2BAAA,WACAzC,EAAAU,MAAAiG,GAAA,aACA3G,EAAAU,MAAA+F,QAAA,YACAzC,KAAA,UAAA6C,IAAAnG,MACAyF,KAAA,WAAA,GACA/F,QAAA,YAKAJ,EAAA4D,UAAAnB,GAAA,SAAA,uBAAA,WACAzC,EAAAU,MAAAiG,GAAA,aACA3G,EAAAU,MAAA+F,QAAA,YACAzC,KAAA,4BAAA6C,IAAAnG,MACAyF,KAAA,WAAA,GACA/F,QAAA,YAOAJ,EAAA4D,UAAAnB,GAAA,SAAA,+BAAA,WAEAzC,EAAAU,MAAA+F,QAAA,QAAAzC,KAAA,oBAAA+B,KAAA,WACAK,EAAApG,EAAAU,MAAA4B,KAAA,aAIA0D,EAAAhG,EAAAU,MAAA4B,KAAA,aAGAtC,EAAA4D,UAAAnB,GAAA,SAAA,+BAAA,WACA2D,EAAApG,EAAAU,MAAA4B,KAAA,aAIAtC,EAAA,oBAAA+F,KAAA,WACAK,EAAApG,EAAAU,MAAA4B,KAAA,YAIA,IAAAwE,GAAA9G,EAAA,wCAAAsC,KAAA,SACA0D,GAAAc,GAQA9G,EAAA,gBAAAgE,KAAA,2CAAAvB,GAAA,SAAA,WACAzC,EAAAU,MAAA+F,QAAA,YAAAzC,KAAA,2CAAA+B,KAAA,WACAO,EAAA5F,UAIAV,EAAA,gBAAAgE,KAAA,2CAAA+B,KAAA,WACAO,EAAA5F,QAIAV,EAAA,qBAAA+G,MAAA,WACA/G,EAAAU,MAAAsG,SAAArG,SAAA,YAAAsG,WAAArG,YAAA","file":"../main.js","sourcesContent":["// Adapted from https://github.com/Heisenbergjs/heisenberg/blob/master/app/app.js\n(function() {\n  window.Coop = window.Coop || {\n\n    Modules: {},\n\n    Events: $({}),\n\n    init: function () {\n      // Loop through all the modules added to the coop.Modules object. We check that the init function of each Module can be called.\n      for(var x in Coop.Modules) {\n        if (Coop.Modules[x].ModuleInitDone !== true && typeof Coop.Modules[x].init === 'function') {\n          Coop.Modules[x].init();\n          Coop.Modules[x].ModuleInitDone = true;\n        }\n      }\n\n      Coop.Events.trigger('render');\n    }\n  };\n})();","(function() {\n\n  'use strict';\n\n  window.Coop = window.Coop || { Modules: {} };\n\n  Coop.Modules.feedbackForm = {\n      toggles:null,\n      toggleContent:null,\n      formPosition:null,\n      init:function(){\n          if($('#FeedbackForm .error').length)   // don't run if form-error\n              return;\n\n          this.toggles = $('#FeedbackForm input[type=\"radio\"]');\n          this.toggleContent = $('#FeedbackForm .slide-toggle-content');\n          this.toggleContent.addClass('init').removeClass('open').attr({tabindex:'-1','aria-hidden':'true','aria-live':'polite'});\n          this.bindEvents();\n      },\n      bindEvents:function(){\n          var self = this;\n\n          this.toggles.change(function(){\n              self.formPosition = $('#FeedbackForm').offset().top;\n              self.toggleContent.slideDown(300).addClass('open').attr('aria-hidden','false');\n              $('html, body').animate({scrollTop:self.formPosition}, 300);\n          });\n      }\n  };\n}());","(function() {\n  'use strict';\n\n  window.Coop = window.Coop || { Modules: {} };\n\n  var selector = '[data-feedback-wrong-info]';\n\n  var FeedbackWrongInfo = function($el) {\n    this.init($el);\n    return this;\n  };\n\n  FeedbackWrongInfo.prototype = {\n    defaults: {\n      email: window.DOORBELL_EMAIL,\n      doorbellId: window.DOORBELL_ID,\n      doorbellKey: window.DOORBELL_KEY\n    },\n    init: function($el) {\n      this.$link = $el;\n      this.pk = this.$link.data('feedback-wrong-info');\n      this.$feedbackPanel = $('#store-feedback-' + this.pk);\n\n      this.bindEvents();\n    },\n    bindEvents: function() {\n      var self = this;\n\n      this.$link\n        .off('click.wrongInfo')\n        .on('click.wrongInfo', function(e) {\n          e.preventDefault();\n\n          self.setupForm();\n\n          if (self.$link.attr('aria-expanded') === 'false') {\n            self.openPanel();\n          }\n          else {\n            self.closePanel();\n          }\n        });\n    },\n    setupForm: function() {\n      var self = this,\n          renderedHtml;\n\n      if ($('[data-feedback-form-' + this.pk + ']').length) {\n        return;\n      }\n\n      renderedHtml = nunjucks.render('feedback.html', {id: this.pk});\n\n      this.$feedbackPanel = $(renderedHtml).insertAfter(this.$link);\n\n      this.$link.attr('aria-controls', 'store-feedback-' + this.pk).attr('aria-expanded', 'false');\n      this.$feedbackPanel.attr('aria-hidden', 'true');\n\n      this.$closeButton = $('.btn-close', this.$feedbackPanel);\n      this.$submitButton = $('button', this.$feedbackPanel);\n      this.$form = $('form', this.$feedbackPanel);\n\n      this.bindPanelEvents();\n    },\n    bindPanelEvents: function() {\n      var self = this;\n\n      this.$closeButton.on('click', function(e) {\n        e.preventDefault();\n        self.closePanel();\n      });\n\n      this.$form.on('submit.wrongInfo', function(e) {\n        e.preventDefault();\n        if (self.validateForm()) {\n          self.sendFeedback();\n        }\n      });\n    },\n    fireRefreshEventOnWindow: function(){\n      var evt = document.createEvent(\"HTMLEvents\");\n      evt.initEvent('resize', true, false);\n      window.dispatchEvent(evt);\n    },\n    openPanel: function() {\n      this.$link.attr('aria-expanded', 'true');\n      this.$feedbackPanel.attr('aria-hidden', 'false').find('textarea').focus();\n      this.fireRefreshEventOnWindow();\n    },\n    closePanel: function() {\n      this.$link.attr('aria-expanded', 'false');\n      this.$feedbackPanel.attr('aria-hidden', 'true');\n      this.fireRefreshEventOnWindow();\n    },\n    getMetadata: function() {\n      return {\n        pk: this.pk,\n        store_name: $('[data-store-id=' + this.pk + '] .store-name').text(),\n        store_address: $('#store-' + this.pk + ' .store-address').text(),\n        store_latlng: $('[data-store-id=' + this.pk + ']').data('latlng'),\n        search_query: $('#q').val()\n      };\n    },\n    sendFeedback: function() {\n      var self = this,\n          message = $('[name=feedback]', this.$form).val();\n\n      if (this.$submitButton.hasClass('btn-loading')) {\n        return;\n      }\n\n      this.$submitButton.attr('disabled', true).addClass('btn-loading');\n\n      $.ajax({\n        url: 'https://doorbell.io/api/applications/' + this.defaults.doorbellId + '/submit?key=' + this.defaults.doorbellKey,\n        data: {\n          email: this.defaults.email,\n          message: message,\n          properties: this.getMetadata()\n        },\n        type: 'POST',\n        success: function() {\n          self.showSuccess();\n        },\n        error: function(xhr, error) {\n          self.showError(null, \"Your feedback could not be sent at this time. Please try again later.\");\n        },\n        complete: function() {\n          self.$submitButton.removeAttr('disabled').removeClass('btn-loading');\n        }\n      });\n    },\n    validateForm: function() {\n      var formIsValid = true;\n\n      this.$form.find('p.form-error').remove();\n      this.$form.find('textarea').removeClass('invalid');\n\n      if (this.$form.find('textarea').val().replace(/(^\\s+|\\s+$)/g, '') === '') {\n        formIsValid = false;\n        this.showError('feedback', 'Please tell us what is wrong with the information above');\n      }\n\n      return formIsValid;\n    },\n    showError: function(field, message) {\n      var $field = $('[name=' + field + ']', this.$form),\n          $error = $('<p class=\"form-error\"></p>').text(message);\n\n      if ($field.length) {\n        $field.addClass('invalid').after($error);\n      }\n      else {\n        this.$form.prepend($error);\n      }\n\n      this.fireRefreshEventOnWindow();\n    },\n    showSuccess: function() {\n      var self = this;\n\n      this.$form.replaceWith('<p class=\"thank-you\">Thanks for helping us to improve our <span class=\"nowrap\">Co-op</span> Finder.</p>');\n      this.$closeButton.on('click', function(e) {\n        e.preventDefault();\n        self.$feedbackPanel.remove();\n        self.$link\n          .removeAttr('aria-expanded')\n          .removeAttr('aria-controls');\n\n        self.init(self.$link);\n      });\n    }\n  };\n\n  Coop.Modules.FeedbackWrongInfo = {\n    init: function() {\n      return $(selector).each(function() {\n        $(this).data('FeedbackWrongInfo', new FeedbackWrongInfo($(this)));\n      });\n    }\n  };\n})();","// Adapted from https://github.com/Heisenbergjs/heisenberg/blob/master/app/app.js\n(function() {\n  window.Coop = window.Coop || {\n\n    Modules: {},\n\n    Events: $({}),\n\n    init: function () {\n      // Loop through all the modules added to the coop.Modules object. We check that the init function of each Module can be called.\n      for(var x in Coop.Modules) {\n        if (Coop.Modules[x].ModuleInitDone !== true && typeof Coop.Modules[x].init === 'function') {\n          Coop.Modules[x].init();\n          Coop.Modules[x].ModuleInitDone = true;\n        }\n      }\n\n      Coop.Events.trigger('render');\n    }\n  };\n})();\n(function() {\n\n  'use strict';\n\n  window.Coop = window.Coop || { Modules: {} };\n\n  Coop.Modules.feedbackForm = {\n      toggles:null,\n      toggleContent:null,\n      formPosition:null,\n      init:function(){\n          if($('#FeedbackForm .error').length)   // don't run if form-error\n              return;\n\n          this.toggles = $('#FeedbackForm input[type=\"radio\"]');\n          this.toggleContent = $('#FeedbackForm .slide-toggle-content');\n          this.toggleContent.addClass('init').removeClass('open').attr({tabindex:'-1','aria-hidden':'true','aria-live':'polite'});\n          this.bindEvents();\n      },\n      bindEvents:function(){\n          var self = this;\n\n          this.toggles.change(function(){\n              self.formPosition = $('#FeedbackForm').offset().top;\n              self.toggleContent.slideDown(300).addClass('open').attr('aria-hidden','false');\n              $('html, body').animate({scrollTop:self.formPosition}, 300);\n          });\n      }\n  };\n}());\n(function() {\n  'use strict';\n\n  window.Coop = window.Coop || { Modules: {} };\n\n  var selector = '[data-feedback-wrong-info]';\n\n  var FeedbackWrongInfo = function($el) {\n    this.init($el);\n    return this;\n  };\n\n  FeedbackWrongInfo.prototype = {\n    defaults: {\n      email: window.DOORBELL_EMAIL,\n      doorbellId: window.DOORBELL_ID,\n      doorbellKey: window.DOORBELL_KEY\n    },\n    init: function($el) {\n      this.$link = $el;\n      this.pk = this.$link.data('feedback-wrong-info');\n      this.$feedbackPanel = $('#store-feedback-' + this.pk);\n\n      this.bindEvents();\n    },\n    bindEvents: function() {\n      var self = this;\n\n      this.$link\n        .off('click.wrongInfo')\n        .on('click.wrongInfo', function(e) {\n          e.preventDefault();\n\n          self.setupForm();\n\n          if (self.$link.attr('aria-expanded') === 'false') {\n            self.openPanel();\n          }\n          else {\n            self.closePanel();\n          }\n        });\n    },\n    setupForm: function() {\n      var self = this,\n          renderedHtml;\n\n      if ($('[data-feedback-form-' + this.pk + ']').length) {\n        return;\n      }\n\n      renderedHtml = nunjucks.render('feedback.html', {id: this.pk});\n\n      this.$feedbackPanel = $(renderedHtml).insertAfter(this.$link);\n\n      this.$link.attr('aria-controls', 'store-feedback-' + this.pk).attr('aria-expanded', 'false');\n      this.$feedbackPanel.attr('aria-hidden', 'true');\n\n      this.$closeButton = $('.btn-close', this.$feedbackPanel);\n      this.$submitButton = $('button', this.$feedbackPanel);\n      this.$form = $('form', this.$feedbackPanel);\n\n      this.bindPanelEvents();\n    },\n    bindPanelEvents: function() {\n      var self = this;\n\n      this.$closeButton.on('click', function(e) {\n        e.preventDefault();\n        self.closePanel();\n      });\n\n      this.$form.on('submit.wrongInfo', function(e) {\n        e.preventDefault();\n        if (self.validateForm()) {\n          self.sendFeedback();\n        }\n      });\n    },\n    fireRefreshEventOnWindow: function(){\n      var evt = document.createEvent(\"HTMLEvents\");\n      evt.initEvent('resize', true, false);\n      window.dispatchEvent(evt);\n    },\n    openPanel: function() {\n      this.$link.attr('aria-expanded', 'true');\n      this.$feedbackPanel.attr('aria-hidden', 'false').find('textarea').focus();\n      this.fireRefreshEventOnWindow();\n    },\n    closePanel: function() {\n      this.$link.attr('aria-expanded', 'false');\n      this.$feedbackPanel.attr('aria-hidden', 'true');\n      this.fireRefreshEventOnWindow();\n    },\n    getMetadata: function() {\n      return {\n        pk: this.pk,\n        store_name: $('[data-store-id=' + this.pk + '] .store-name').text(),\n        store_address: $('#store-' + this.pk + ' .store-address').text(),\n        store_latlng: $('[data-store-id=' + this.pk + ']').data('latlng'),\n        search_query: $('#q').val()\n      };\n    },\n    sendFeedback: function() {\n      var self = this,\n          message = $('[name=feedback]', this.$form).val();\n\n      if (this.$submitButton.hasClass('btn-loading')) {\n        return;\n      }\n\n      this.$submitButton.attr('disabled', true).addClass('btn-loading');\n\n      $.ajax({\n        url: 'https://doorbell.io/api/applications/' + this.defaults.doorbellId + '/submit?key=' + this.defaults.doorbellKey,\n        data: {\n          email: this.defaults.email,\n          message: message,\n          properties: this.getMetadata()\n        },\n        type: 'POST',\n        success: function() {\n          self.showSuccess();\n        },\n        error: function(xhr, error) {\n          self.showError(null, \"Your feedback could not be sent at this time. Please try again later.\");\n        },\n        complete: function() {\n          self.$submitButton.removeAttr('disabled').removeClass('btn-loading');\n        }\n      });\n    },\n    validateForm: function() {\n      var formIsValid = true;\n\n      this.$form.find('p.form-error').remove();\n      this.$form.find('textarea').removeClass('invalid');\n\n      if (this.$form.find('textarea').val().replace(/(^\\s+|\\s+$)/g, '') === '') {\n        formIsValid = false;\n        this.showError('feedback', 'Please tell us what is wrong with the information above');\n      }\n\n      return formIsValid;\n    },\n    showError: function(field, message) {\n      var $field = $('[name=' + field + ']', this.$form),\n          $error = $('<p class=\"form-error\"></p>').text(message);\n\n      if ($field.length) {\n        $field.addClass('invalid').after($error);\n      }\n      else {\n        this.$form.prepend($error);\n      }\n\n      this.fireRefreshEventOnWindow();\n    },\n    showSuccess: function() {\n      var self = this;\n\n      this.$form.replaceWith('<p class=\"thank-you\">Thanks for helping us to improve our <span class=\"nowrap\">Co-op</span> Finder.</p>');\n      this.$closeButton.on('click', function(e) {\n        e.preventDefault();\n        self.$feedbackPanel.remove();\n        self.$link\n          .removeAttr('aria-expanded')\n          .removeAttr('aria-controls');\n\n        self.init(self.$link);\n      });\n    }\n  };\n\n  Coop.Modules.FeedbackWrongInfo = {\n    init: function() {\n      return $(selector).each(function() {\n        $(this).data('FeedbackWrongInfo', new FeedbackWrongInfo($(this)));\n      });\n    }\n  };\n})();\n\n$(function(){\n\n  $('.dm-page-nav').fixedsticky();\n\n  // $.fn.isInViewport = function() {\n  //   var elementTop = $(\".example-full\").offset().top;\n  //   var elementBottom = elementTop + $(\".example-full\").outerHeight();\n  //   var viewportTop = $(window).scrollTop();\n  //   var viewportBottom = viewportTop + $(window).height();\n  //   return elementBottom > viewportTop && elementTop < viewportBottom;\n  // };\n  //\n  //\n  // $(window).on('resize scroll', function() {\n  //   var fixed = $('.fixedsticky');\n  //\n  //   var fixed_position = $('.fixedsticky').offset().top;\n  //   var fixed_height = $('.fixedsticky').height();\n  //\n  //   if ($('.example-full').isInViewport()) {\n  //\n  //     var toCross_position = $('.example-full').offset().top;\n  //     var toCross_height = $('.example-full').height();\n  //\n  //     // $('.example-full').each(function() {\n  //     //\n  //     //\n  //     //\n  //     // });\n  //\n  //     if (fixed_position + fixed_height  < toCross_position) {\n  //       fixed.removeClass('is--hidden');\n  //     } else if (fixed_position > toCross_position + toCross_height) {\n  //       fixed.removeClass('is--hidden');\n  //     } else {\n  //       fixed.addClass('is--hidden');\n  //     }\n  //\n  //   }\n  // });\n\n  Coop.init();\n\n  function showElement(element) {\n    $(element).show().removeAttr('hidden').attr('aria-hidden', false);\n    $(element).find(':input').prop('disabled', false);\n  }\n\n  function hideElement(element) {\n    $(element).hide().attr('hidden', '').attr('aria-hidden', true);\n    $(element).find(':input').prop('disabled', true);\n  }\n\n  // When \"none of the above\" checked, uncheck all others in fieldset\n  $(document).on('change', '[data-none-of-the-above]', function(){\n    if ($(this).is(':checked')) {\n      $(this).parents('fieldset')\n        .find(':input').not(this)\n        .prop('checked', false)\n        .trigger('change');\n    }\n  });\n\n  // When any checkbox checked, uncheck \"none of the above\" if it exists\n  $(document).on('change', 'input[type=checkbox]', function(){\n    if ($(this).is(':checked')) {\n      $(this).parents('fieldset')\n        .find('[data-none-of-the-above]').not(this)\n        .prop('checked', false)\n        .trigger('change');\n    }\n  });\n\n  // Allow content to be revealed after selecting a radio button.\n  // Add a data-show attribute to the input\n  // and specify the target with data-target='#foo'\n  $(document).on('change', \"input[type=radio][data-show]\", function(){\n    // hide all targets within the container\n    $(this).parents(\"form\").find(\"input[data-show]\").each(function(){\n      hideElement($(this).data('target'));\n    });\n\n    // show the selected target\n    showElement($(this).data('target'));\n  });\n\n  $(document).on('change', \"input[type=radio][data-hide]\", function(){\n    hideElement($(this).data('target'));\n  });\n\n  // On page load, hide all the toggle-able content\n  $(\"input[data-show]\").each(function(){\n    hideElement($(this).data('target'));\n  });\n\n  // ...and show the selected radio button's target\n  var $target = $(\"input[type=radio][data-show]:checked\").data('target');\n  showElement($target);\n\n  function toggleInputLabelClass(input) {\n    var $input = $(input);\n\n    $input.parents(\".block-label\").toggleClass(\"checked\", $input.is(\":checked\"));\n  }\n\n  $(\".block-label\").find(\"input[type=checkbox], input[type=radio]\").on(\"change\", function(){\n    $(this).parents('fieldset').find('input[type=checkbox], input[type=radio]').each(function(){\n      toggleInputLabelClass(this);\n    });\n  });\n\n  $(\".block-label\").find(\"input[type=checkbox], input[type=radio]\").each(function(){\n    toggleInputLabelClass(this);\n  });\n\n// In page nav add class to active link\n$(\"#in-page-nav li a\").click(function() {\n    $(this).parent().addClass('selected').siblings().removeClass('selected');\n    });\n});\n"]}