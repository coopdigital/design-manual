!function(){window.Coop=window.Coop||{Modules:{},Events:$({}),init:function(){for(var t in Coop.Modules)Coop.Modules[t].ModuleInitDone!==!0&&"function"==typeof Coop.Modules[t].init&&(Coop.Modules[t].init(),Coop.Modules[t].ModuleInitDone=!0);Coop.Events.trigger("render")}}}(),function(){"use strict";window.Coop=window.Coop||{Modules:{}},Coop.Modules.feedbackForm={toggles:null,toggleContent:null,formPosition:null,init:function(){$("#FeedbackForm .error").length||(this.toggles=$('#FeedbackForm input[type="radio"]'),this.toggleContent=$("#FeedbackForm .slide-toggle-content"),this.toggleContent.addClass("init").removeClass("open").attr({tabindex:"-1","aria-hidden":"true","aria-live":"polite"}),this.bindEvents())},bindEvents:function(){var t=this;this.toggles.change(function(){t.formPosition=$("#FeedbackForm").offset().top,t.toggleContent.slideDown(300).addClass("open").attr("aria-hidden","false"),$("html, body").animate({scrollTop:t.formPosition},300)})}}}(),function(){"use strict";window.Coop=window.Coop||{Modules:{}};var t="[data-feedback-wrong-info]",e=function(t){return this.init(t),this};e.prototype={defaults:{email:window.DOORBELL_EMAIL,doorbellId:window.DOORBELL_ID,doorbellKey:window.DOORBELL_KEY},init:function(t){this.$link=t,this.pk=this.$link.data("feedback-wrong-info"),this.$feedbackPanel=$("#store-feedback-"+this.pk),this.bindEvents()},bindEvents:function(){var t=this;this.$link.off("click.wrongInfo").on("click.wrongInfo",function(e){e.preventDefault(),t.setupForm(),"false"===t.$link.attr("aria-expanded")?t.openPanel():t.closePanel()})},setupForm:function(){var t;$("[data-feedback-form-"+this.pk+"]").length||(t=nunjucks.render("feedback.html",{id:this.pk}),this.$feedbackPanel=$(t).insertAfter(this.$link),this.$link.attr("aria-controls","store-feedback-"+this.pk).attr("aria-expanded","false"),this.$feedbackPanel.attr("aria-hidden","true"),this.$closeButton=$(".btn-close",this.$feedbackPanel),this.$submitButton=$("button",this.$feedbackPanel),this.$form=$("form",this.$feedbackPanel),this.bindPanelEvents())},bindPanelEvents:function(){var t=this;this.$closeButton.on("click",function(e){e.preventDefault(),t.closePanel()}),this.$form.on("submit.wrongInfo",function(e){e.preventDefault(),t.validateForm()&&t.sendFeedback()})},fireRefreshEventOnWindow:function(){var t=document.createEvent("HTMLEvents");t.initEvent("resize",!0,!1),window.dispatchEvent(t)},openPanel:function(){this.$link.attr("aria-expanded","true"),this.$feedbackPanel.attr("aria-hidden","false").find("textarea").focus(),this.fireRefreshEventOnWindow()},closePanel:function(){this.$link.attr("aria-expanded","false"),this.$feedbackPanel.attr("aria-hidden","true"),this.fireRefreshEventOnWindow()},getMetadata:function(){return{pk:this.pk,store_name:$("[data-store-id="+this.pk+"] .store-name").text(),store_address:$("#store-"+this.pk+" .store-address").text(),store_latlng:$("[data-store-id="+this.pk+"]").data("latlng"),search_query:$("#q").val()}},sendFeedback:function(){var t=this,e=$("[name=feedback]",this.$form).val();this.$submitButton.hasClass("btn-loading")||(this.$submitButton.attr("disabled",!0).addClass("btn-loading"),$.ajax({url:"https://doorbell.io/api/applications/"+this.defaults.doorbellId+"/submit?key="+this.defaults.doorbellKey,data:{email:this.defaults.email,message:e,properties:this.getMetadata()},type:"POST",success:function(){t.showSuccess()},error:function(e,n){t.showError(null,"Your feedback could not be sent at this time. Please try again later.")},complete:function(){t.$submitButton.removeAttr("disabled").removeClass("btn-loading")}}))},validateForm:function(){var t=!0;return this.$form.find("p.form-error").remove(),this.$form.find("textarea").removeClass("invalid"),""===this.$form.find("textarea").val().replace(/(^\s+|\s+$)/g,"")&&(t=!1,this.showError("feedback","Please tell us what is wrong with the information above")),t},showError:function(t,e){var n=$("[name="+t+"]",this.$form),i=$('<p class="form-error"></p>').text(e);n.length?n.addClass("invalid").after(i):this.$form.prepend(i),this.fireRefreshEventOnWindow()},showSuccess:function(){var t=this;this.$form.replaceWith('<p class="thank-you">Thanks for helping us to improve our <span class="nowrap">Co-op</span> Finder.</p>'),this.$closeButton.on("click",function(e){e.preventDefault(),t.$feedbackPanel.remove(),t.$link.removeAttr("aria-expanded").removeAttr("aria-controls"),t.init(t.$link)})}},Coop.Modules.FeedbackWrongInfo={init:function(){return $(t).each(function(){$(this).data("FeedbackWrongInfo",new e($(this)))})}}}(),$(function(){function t(t){$(t).show().removeAttr("hidden").attr("aria-hidden",!1),$(t).find(":input").prop("disabled",!1)}function e(t){$(t).hide().attr("hidden","").attr("aria-hidden",!0),$(t).find(":input").prop("disabled",!0)}function n(t){var e=$(t);e.parents(".block-label").toggleClass("checked",e.is(":checked"))}$(".dm-page-nav").fixedsticky(),Coop.init(),$(document).on("change","[data-none-of-the-above]",function(){$(this).is(":checked")&&$(this).parents("fieldset").find(":input").not(this).prop("checked",!1).trigger("change")}),$(document).on("change","input[type=checkbox]",function(){$(this).is(":checked")&&$(this).parents("fieldset").find("[data-none-of-the-above]").not(this).prop("checked",!1).trigger("change")}),$(document).on("change","input[type=radio][data-show]",function(){$(this).parents("form").find("input[data-show]").each(function(){e($(this).data("target"))}),t($(this).data("target"))}),$(document).on("change","input[type=radio][data-hide]",function(){e($(this).data("target"))}),$("input[data-show]").each(function(){e($(this).data("target"))});var i=$("input[type=radio][data-show]:checked").data("target");t(i),$(".block-label").find("input[type=checkbox], input[type=radio]").on("change",function(){$(this).parents("fieldset").find("input[type=checkbox], input[type=radio]").each(function(){n(this)})}),$(".block-label").find("input[type=checkbox], input[type=radio]").each(function(){n(this)}),$("#in-page-nav li a").click(function(){$(this).parent().addClass("selected").siblings().removeClass("selected")})});
//# sourceMappingURL=maps/main.js.map
